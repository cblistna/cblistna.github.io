<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendar</title>
  </head>
  <body style="background-color: lightgray; padding: 1rem 1rem">
    <h1>Calendar</h1>
    <h2>Promo</h2>
    <div id="promo"></div>
    <h2>Services</h2>
    <div id="services"></div>
    <h2>Events</h2>
    <div id="events"></div>
  </body>

  <script type="module">
    import {
      now,
      today,
      fetchEvents,
      fetchServices,
      fetchPromo,
    } from "./calendar.js";

    const CALENDAR_ID = "trinec.v@cb.cz";
    const SERVICES_SHEET = "1kgTaxURvNYcos2UyGNkaxdqjtJMuqU7Rcftn-bFJ4pI";
    const SERVICES_RANGE = "A1:K20";
    const PROMO_FOLDER_ID = "166V_D3l4DwwOjrLeEhM12m69ZOvbcTc6";

    const services = await fetchServices(SERVICES_SHEET, SERVICES_RANGE);
    document.getElementById("services").innerHTML = `
      ${services
        .map(
          (service) => `
        <p style="font-family: Consolas">
          ${[
            service.date,
            service.moderator,
            service.teacher,
            service.subject,
            service.body,
            service.worshipLeader,
            service.childrenProgram,
            service.projector,
            service.soundMaster,
            service.birthdays,
          ].join(" | ")}
        </p>
      `
        )
        .join("\n")}`;

    const events = await fetchEvents(CALENDAR_ID);
    document.getElementById("events").innerHTML = `
      ${events
        .map(
          (event) => `
        <p style="font-family: Consolas">
          ${[
            event.start,
            event.end,
            event.subject,
            event.body,
            event.recurring
              ? "R"
              : "" + `[${Object.entries(event.tags).map(([t, v]) => t)}]`,
            JSON.stringify(event.duration),
            JSON.stringify(event.attachments.map((a) => a.name)),
          ].join(" | ")}
        </p>
      `
        )
        .join("\n")}`;

    const promotions = await fetchPromo(PROMO_FOLDER_ID);
    document.getElementById("promo").innerHTML = `
      ${promotions
        .map(
          (event) => `
        <p style="font-family: Consolas">
          ${[
            event.start,
            event.end,
            event.subject,
            event.body,
            event.recurring
              ? "R"
              : "" + `[${Object.entries(event.tags).map(([t, v]) => t)}]`,
            JSON.stringify(event.duration),
            JSON.stringify(event.attachments.map((a) => a.name)),
          ].join(" | ")}
        </p>
      `
        )
        .join("\n")}`;
  </script>
</html>
